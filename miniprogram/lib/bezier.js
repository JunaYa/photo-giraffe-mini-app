"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var point_1 = require("./point");
var Bezier = (function () {
    function Bezier(startPoint, control2, control1, endPoint, startWidth, endWidth) {
        this.startPoint = startPoint;
        this.control2 = control2;
        this.control1 = control1;
        this.endPoint = endPoint;
        this.startWidth = startWidth;
        this.endWidth = endWidth;
    }
    Bezier.fromPoints = function (points, widths) {
        var c2 = this.calculateControlPoints(points[0], points[1], points[2]).c2;
        var c3 = this.calculateControlPoints(points[1], points[2], points[3]).c1;
        return new Bezier(points[1], c2, c3, points[2], widths.start, widths.end);
    };
    Bezier.calculateControlPoints = function (s1, s2, s3) {
        var dx1 = s1.x - s2.x;
        var dy1 = s1.y - s2.y;
        var dx2 = s2.x - s3.x;
        var dy2 = s2.y - s3.y;
        var m1 = { x: (s1.x + s2.x) / 2.0, y: (s1.y + s2.y) / 2.0 };
        var m2 = { x: (s2.x + s3.x) / 2.0, y: (s2.y + s3.y) / 2.0 };
        var l1 = Math.sqrt(dx1 * dx1 + dy1 * dy1);
        var l2 = Math.sqrt(dx2 * dx2 + dy2 * dy2);
        var dxm = m1.x - m2.x;
        var dym = m1.y - m2.y;
        var k = l2 / (l1 + l2);
        var cm = { x: m2.x + dxm * k, y: m2.y + dym * k };
        var tx = s2.x - cm.x;
        var ty = s2.y - cm.y;
        return {
            c1: new point_1.Point(m1.x + tx, m1.y + ty),
            c2: new point_1.Point(m2.x + tx, m2.y + ty),
        };
    };
    Bezier.prototype.length = function () {
        var steps = 10;
        var length = 0;
        var px;
        var py;
        for (var i = 0; i <= steps; i += 1) {
            var t = i / steps;
            var cx = this.point(t, this.startPoint.x, this.control1.x, this.control2.x, this.endPoint.x);
            var cy = this.point(t, this.startPoint.y, this.control1.y, this.control2.y, this.endPoint.y);
            if (i > 0) {
                var xdiff = cx - px;
                var ydiff = cy - py;
                length += Math.sqrt(xdiff * xdiff + ydiff * ydiff);
            }
            px = cx;
            py = cy;
        }
        return length;
    };
    Bezier.prototype.point = function (t, start, c1, c2, end) {
        return (start * (1.0 - t) * (1.0 - t) * (1.0 - t))
            + (3.0 * c1 * (1.0 - t) * (1.0 - t) * t)
            + (3.0 * c2 * (1.0 - t) * t * t)
            + (end * t * t * t);
    };
    return Bezier;
}());
exports.Bezier = Bezier;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYmV6aWVyLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiYmV6aWVyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQUEsaUNBQTRDO0FBRTVDO0lBNkNFLGdCQUNTLFVBQWlCLEVBQ2pCLFFBQW9CLEVBQ3BCLFFBQW9CLEVBQ3BCLFFBQWUsRUFDZixVQUFrQixFQUNsQixRQUFnQjtRQUxoQixlQUFVLEdBQVYsVUFBVSxDQUFPO1FBQ2pCLGFBQVEsR0FBUixRQUFRLENBQVk7UUFDcEIsYUFBUSxHQUFSLFFBQVEsQ0FBWTtRQUNwQixhQUFRLEdBQVIsUUFBUSxDQUFPO1FBQ2YsZUFBVSxHQUFWLFVBQVUsQ0FBUTtRQUNsQixhQUFRLEdBQVIsUUFBUSxDQUFRO0lBQ3RCLENBQUM7SUFuRFUsaUJBQVUsR0FBeEIsVUFDRSxNQUFlLEVBQ2YsTUFBc0M7UUFFdEMsSUFBTSxFQUFFLEdBQUcsSUFBSSxDQUFDLHNCQUFzQixDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsRUFBRSxNQUFNLENBQUMsQ0FBQyxDQUFDLEVBQUUsTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDO1FBQzNFLElBQU0sRUFBRSxHQUFHLElBQUksQ0FBQyxzQkFBc0IsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLEVBQUUsTUFBTSxDQUFDLENBQUMsQ0FBQyxFQUFFLE1BQU0sQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQztRQUUzRSxPQUFPLElBQUksTUFBTSxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFLE1BQU0sQ0FBQyxDQUFDLENBQUMsRUFBRSxNQUFNLENBQUMsS0FBSyxFQUFFLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQztJQUM1RSxDQUFDO0lBRWMsNkJBQXNCLEdBQXJDLFVBQ0UsRUFBYyxFQUNkLEVBQWMsRUFDZCxFQUFjO1FBS2QsSUFBTSxHQUFHLEdBQUcsRUFBRSxDQUFDLENBQUMsR0FBRyxFQUFFLENBQUMsQ0FBQyxDQUFDO1FBQ3hCLElBQU0sR0FBRyxHQUFHLEVBQUUsQ0FBQyxDQUFDLEdBQUcsRUFBRSxDQUFDLENBQUMsQ0FBQztRQUN4QixJQUFNLEdBQUcsR0FBRyxFQUFFLENBQUMsQ0FBQyxHQUFHLEVBQUUsQ0FBQyxDQUFDLENBQUM7UUFDeEIsSUFBTSxHQUFHLEdBQUcsRUFBRSxDQUFDLENBQUMsR0FBRyxFQUFFLENBQUMsQ0FBQyxDQUFDO1FBRXhCLElBQU0sRUFBRSxHQUFHLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLENBQUMsR0FBRyxFQUFFLENBQUMsQ0FBQyxDQUFDLEdBQUcsR0FBRyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFDLEdBQUcsRUFBRSxDQUFDLENBQUMsQ0FBQyxHQUFHLEdBQUcsRUFBRSxDQUFDO1FBQzlELElBQU0sRUFBRSxHQUFHLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLENBQUMsR0FBRyxFQUFFLENBQUMsQ0FBQyxDQUFDLEdBQUcsR0FBRyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFDLEdBQUcsRUFBRSxDQUFDLENBQUMsQ0FBQyxHQUFHLEdBQUcsRUFBRSxDQUFDO1FBRTlELElBQU0sRUFBRSxHQUFHLElBQUksQ0FBQyxJQUFJLENBQUMsR0FBRyxHQUFHLEdBQUcsR0FBRyxHQUFHLEdBQUcsR0FBRyxDQUFDLENBQUM7UUFDNUMsSUFBTSxFQUFFLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQyxHQUFHLEdBQUcsR0FBRyxHQUFHLEdBQUcsR0FBRyxHQUFHLENBQUMsQ0FBQztRQUU1QyxJQUFNLEdBQUcsR0FBRyxFQUFFLENBQUMsQ0FBQyxHQUFHLEVBQUUsQ0FBQyxDQUFDLENBQUM7UUFDeEIsSUFBTSxHQUFHLEdBQUcsRUFBRSxDQUFDLENBQUMsR0FBRyxFQUFFLENBQUMsQ0FBQyxDQUFDO1FBRXhCLElBQU0sQ0FBQyxHQUFHLEVBQUUsR0FBRyxDQUFDLEVBQUUsR0FBRyxFQUFFLENBQUMsQ0FB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LElBMEdDO0FBMUdZLHdCQUFNIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQmFzaWNQb2ludCwgUG9pbnQgfSBmcm9tICcuL3BvaW50JztcblxuZXhwb3J0IGNsYXNzIEJlemllciB7XG4gIHB1YmxpYyBzdGF0aWMgZnJvbVBvaW50cyhcbiAgICBwb2ludHM6IFBvaW50W10sXG4gICAgd2lkdGhzOiB7IHN0YXJ0OiBudW1iZXI7IGVuZDogbnVtYmVyIH0sXG4gICk6IEJlemllciB7XG4gICAgY29uc3QgYzIgPSB0aGlzLmNhbGN1bGF0ZUNvbnRyb2xQb2ludHMocG9pbnRzWzBdLCBwb2ludHNbMV0sIHBvaW50c1syXSkuYzI7XG4gICAgY29uc3QgYzMgPSB0aGlzLmNhbGN1bGF0ZUNvbnRyb2xQb2ludHMocG9pbnRzWzFdLCBwb2ludHNbMl0sIHBvaW50c1szXSkuYzE7XG5cbiAgICByZXR1cm4gbmV3IEJlemllcihwb2ludHNbMV0sIGMyLCBjMywgcG9pbnRzWzJdLCB3aWR0aHMuc3RhcnQsIHdpZHRocy5lbmQpO1xuICB9XG5cbiAgcHJpdmF0ZSBzdGF0aWMgY2FsY3VsYXRlQ29udHJvbFBvaW50cyhcbiAgICBzMTogQmFzaWNQb2ludCxcbiAgICBzMjogQmFzaWNQb2ludCxcbiAgICBzMzogQmFzaWNQb2ludCxcbiAgKToge1xuICAgIGMxOiBCYXNpY1BvaW50O1xuICAgIGMyOiBCYXNpY1BvaW50O1xuICB9IHtcbiAgICBjb25zdCBkeDEgPSBzMS54IC0gczIueDtcbiAgICBjb25zdCBkeTEgPSBzMS55IC0gczIueTtcbiAgICBjb25zdCBkeDIgPSBzMi54IC0gczMueDtcbiAgICBjb25zdCBkeTIgPSBzMi55IC0gczMueTtcblxuICAgIGNvbnN0IG0xID0geyB4OiAoczEueCArIHMyLngpIC8gMi4wLCB5OiAoczEueSArIHMyLnkpIC8gMi4wIH07XG4gICAgY29uc3QgbTIgPSB7IHg6IChzMi54ICsgczMueCkgLyAyLjAsIHk6IChzMi55ICsgczMueSkgLyAyLjAgfTtcblxuICAgIGNvbnN0IGwxID0gTWF0aC5zcXJ0KGR4MSAqIGR4MSArIGR5MSAqIGR5MSk7XG4gICAgY29uc3QgbDIgPSBNYXRoLnNxcnQoZHgyICogZHgyICsgZHkyICogZHkyKTtcblxuICAgIGNvbnN0IGR4bSA9IG0xLnggLSBtMi54O1xuICAgIGNvbnN0IGR5bSA9IG0xLnkgLSBtMi55O1xuXG4gICAgY29uc3QgayA9IGwyIC8gKGwxICsgbDIpO1xuICAgIGNvbnN0IGNtID0geyB4OiBtMi54ICsgZHhtICogaywgeTogbTIueSArIGR5bSAqIGsgfTtcblxuICAgIGNvbnN0IHR4ID0gczIueCAtIGNtLng7XG4gICAgY29uc3QgdHkgPSBzMi55IC0gY20ueTtcblxuICAgIHJldHVybiB7XG4gICAgICBjMTogbmV3IFBvaW50KG0xLnggKyB0eCwgbTEueSArIHR5KSxcbiAgICAgIGMyOiBuZXcgUG9pbnQobTIueCArIHR4LCBtMi55ICsgdHkpLFxuICAgIH07XG4gIH1cblxuICBjb25zdHJ1Y3RvcihcbiAgICBwdWJsaWMgc3RhcnRQb2ludDogUG9pbnQsXG4gICAgcHVibGljIGNvbnRyb2wyOiBCYXNpY1BvaW50LFxuICAgIHB1YmxpYyBjb250cm9sMTogQmFzaWNQb2ludCxcbiAgICBwdWJsaWMgZW5kUG9pbnQ6IFBvaW50LFxuICAgIHB1YmxpYyBzdGFydFdpZHRoOiBudW1iZXIsXG4gICAgcHVibGljIGVuZFdpZHRoOiBudW1iZXIsXG4gICkge31cblxuICAvLyBSZXR1cm5zIGFwcHJveGltYXRlZCBsZW5ndGguIENvZGUgdGFrZW4gZnJvbSBodHRwczovL3d3dy5sZW1vZGEubmV0L21hdGhzL2Jlemllci1sZW5ndGgvaW5kZXguaHRtbC5cbiAgcHVibGljIGxlbmd0aCgpOiBudW1iZXIge1xuICAgIGNvbnN0IHN0ZXBzID0gMTA7XG4gICAgbGV0IGxlbmd0aCA9IDA7XG4gICAgbGV0IHB4O1xuICAgIGxldCBweTtcblxuICAgIGZvciAobGV0IGkgPSAwOyBpIDw9IHN0ZXBzOyBpICs9IDEpIHtcbiAgICAgIGNvbnN0IHQgPSBpIC8gc3RlcHM7XG4gICAgICBjb25zdCBjeCA9IHRoaXMucG9pbnQoXG4gICAgICAgIHQsXG4gICAgICAgIHRoaXMuc3RhcnRQb2ludC54LFxuICAgICAgICB0aGlzLmNvbnRyb2wxLngsXG4gICAgICAgIHRoaXMuY29udHJvbDIueCxcbiAgICAgICAgdGhpcy5lbmRQb2ludC54LFxuICAgICAgKTtcbiAgICAgIGNvbnN0IGN5ID0gdGhpcy5wb2ludChcbiAgICAgICAgdCxcbiAgICAgICAgdGhpcy5zdGFydFBvaW50LnksXG4gICAgICAgIHRoaXMuY29udHJvbDEueSxcbiAgICAgICAgdGhpcy5jb250cm9sMi55LFxuICAgICAgICB0aGlzLmVuZFBvaW50LnksXG4gICAgICApO1xuXG4gICAgICBpZiAoaSA+IDApIHtcbiAgICAgICAgY29uc3QgeGRpZmYgPSBjeCAtIChweCBhcyBudW1iZXIpO1xuICAgICAgICBjb25zdCB5ZGlmZiA9IGN5IC0gKHB5IGFzIG51bWJlcik7XG5cbiAgICAgICAgbGVuZ3RoICs9IE1hdGguc3FydCh4ZGlmZiAqIHhkaWZmICsgeWRpZmYgKiB5ZGlmZik7XG4gICAgICB9XG5cbiAgICAgIHB4ID0gY3g7XG4gICAgICBweSA9IGN5O1xuICAgIH1cblxuICAgIHJldHVybiBsZW5ndGg7XG4gIH1cblxuICAvLyBDYWxjdWxhdGUgcGFyYW1ldHJpYyB2YWx1ZSBvZiB4IG9yIHkgZ2l2ZW4gdCBhbmQgdGhlIGZvdXIgcG9pbnQgY29vcmRpbmF0ZXMgb2YgYSBjdWJpYyBiZXppZXIgY3VydmUuXG4gIHByaXZhdGUgcG9pbnQoXG4gICAgdDogbnVtYmVyLFxuICAgIHN0YXJ0OiBudW1iZXIsXG4gICAgYzE6IG51bWJlcixcbiAgICBjMjogbnVtYmVyLFxuICAgIGVuZDogbnVtYmVyLFxuICApOiBudW1iZXIge1xuICAgIC8vIHByZXR0aWVyLWlnbm9yZVxuICAgIHJldHVybiAoICAgICAgIHN0YXJ0ICogKDEuMCAtIHQpICogKDEuMCAtIHQpICAqICgxLjAgLSB0KSlcbiAgICAgICAgICsgKDMuMCAqICBjMSAgICAqICgxLjAgLSB0KSAqICgxLjAgLSB0KSAgKiB0KVxuICAgICAgICAgKyAoMy4wICogIGMyICAgICogKDEuMCAtIHQpICogdCAgICAgICAgICAqIHQpXG4gICAgICAgICArICggICAgICAgZW5kICAgKiB0ICAgICAgICAgKiB0ICAgICAgICAgICogdCk7XG4gIH1cbn1cbiJdfQ==